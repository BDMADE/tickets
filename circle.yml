machine:
  ruby:
    version: 2.3.1
dependencies:
  pre:
    - gem install bundler
  post:
    - bundle exec rake assets:precompile RAILS_ENV=production
database:
  override:
    - bundle exec rake db:environment:set RAILS_ENV=test
    - bundle exec rake db:drop
    - bundle exec rake db:create RAILS_ENV=test
    - bundle exec rake db:migrate RAILS_ENV=test
test:
  override:
  - bundle exec rspec spec
  - "[[ ! -s \"$(git rev-parse --git-dir)/shallow\" ]] || git fetch --unshallow"
  - "[[ ! -z \"${CI_PULL_REQUEST}\" ]] && bundle exec pronto run -f bitbucket_status bitbucket_pr -c origin/master || true"
